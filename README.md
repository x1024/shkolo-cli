# Shkolo CLI

Интерфейс за команден ред и TUI (Terminal User Interface) за [Shkolo.bg](https://shkolo.bg) - българската система за управление на училища. Преглеждайте оценки, домашни, разписание, отсъствия и съобщения директно от терминала.

## Функционалности

- **Интерактивен TUI** - Пълнофункционален терминален интерфейс с клавиатурна навигация
- **JSON изход** - Структурирани данни за скриптове и AI асистенти
- **Поддръжка за няколко ученика** - Превключване между деца с един бутон
- **Двуезичен** - Български и английски интерфейс (превключване с `G`)
- **Кеширане** - Интелигентно кеширане за намаляване на API заявките
- **OpenClaw съвместимост** - Работи с [OpenClaw](https://github.com/AustinDizworthy/openclaw) за AI заявки

## Инсталация

```bash
# Клониране и компилиране
git clone https://github.com/user/shkolo.git
cd shkolo
cargo build --release

# Изпълнимият файл е в ./target/release/shkolo
```

## Автентикация

### Вариант 1: Импорт на токен от iOS приложението (Препоръчително)

Ако имате инсталирано Shkolo iOS приложението, можете да извлечете и импортирате вашия токен:

1. Използвайте инструмент като [MITM Proxy](https://mitmproxy.org/) за да прихванете `Authorization: Bearer <token>` хедъра от iOS приложението
2. Изпълнете командата за импорт:

```bash
shkolo import-token
# Поставете токена когато бъдете подканени
```

### Вариант 2: Вход с потребителско име и парола

```bash
# Интерактивен вход
shkolo login

# Или с флагове
shkolo login -u вашият@email.com -p вашатапарола
```

### Вариант 3: Вход с Google

```bash
shkolo login-google
# Следвайте OAuth процеса в браузъра
```

### Проверка на статуса

```bash
shkolo status
```

### Изход

```bash
shkolo logout
```

## TUI режим

Стартиране на интерактивния терминален интерфейс:

```bash
shkolo tui
```

### Навигация

| Клавиш | Действие |
|--------|----------|
| `←` `h` `{` | Предишен таб |
| `→` `l` `}` | Следващ таб |
| `1-9` | Бърз избор на таб |
| `Tab` | Превключване на фокуса между панели |
| `↓` `j` | Надолу / Следващ елемент |
| `↑` `k` | Нагоре / Предишен елемент |
| `Enter` | Отваряне/активиране на избрания елемент |
| `Backspace` | Назад (като в браузър) |
| `Shift+Backspace` | Напред |
| `?` | Показване на клавишни комбинации |
| `q` `Esc` | Изход |

### Данни и дисплей

| Клавиш | Действие |
|--------|----------|
| `r` | Опресняване на текущите данни |
| `R` | Принудително опресняване (без кеш) |
| `G` | Превключване на езика (BG/EN) |
| `-` `+` `=` | Преоразмеряване на панела с ученици |
| `<` `>` | Преоразмеряване на вертикални разделители |

### Таб Разписание

| Клавиш | Действие |
|--------|----------|
| `p` | Предишен ден |
| `n` | Следващ ден |
| `t` | Към днес |

### Таб Съобщения

| Клавиш | Действие |
|--------|----------|
| `Enter` | Отваряне на нишка |
| `c` | Ново съобщение |
| `r` | Отговор (при преглед на нишка) |
| `Esc` | Затваряне на нишка / Отказ |

### Създаване на съобщение

| Клавиш | Действие |
|--------|----------|
| `Tab` | Следващо поле (Получатели → Тема → Съобщение) |
| `Shift+Tab` | Предишно поле |
| `Space` / `Enter` | Избор/отказ на получател |
| `Enter` (в съобщение) | Изпращане |
| `Esc` | Отказ |

### Поддръжка на мишка

- Клик върху табове за превключване
- Клик върху елементи за избор
- Влачене на границите за преоразмеряване
- Скрол за навигация в списъци

## CLI режим (JSON изход)

За скриптове и интеграция с AI асистенти, използвайте JSON подкомандите:

```bash
# Списък на всички ученици
shkolo json students

# Домашни за всички ученици
shkolo json homework

# Оценки
shkolo json grades

# Разписание за днес
shkolo json schedule

# Отсъствия
shkolo json absences

# Отзиви (значки/бележки)
shkolo json feedbacks

# Известия
shkolo json notifications

# Съобщения
shkolo json messages

# Пълно обобщение
shkolo json summary
```

### Опции

```bash
# Принудително опресняване от API
shkolo json --refresh homework

# Компактен JSON изход (един ред)
shkolo json --format compact grades

# Без кеш
shkolo json --no-cache schedule

# Персонализиран TTL на кеша (в секунди)
shkolo json --cache-ttl 1800 summary
```

## Използване с OpenClaw

[OpenClaw](https://github.com/AustinDizworthy/openclaw) позволява да правите заявки към училищните данни с естествен език чрез AI.

### Настройка

1. Инсталирайте OpenClaw според техните инструкции
2. Добавете Shkolo като източник на данни във вашата OpenClaw конфигурация:

```yaml
tools:
  - name: shkolo
    command: shkolo json summary
    description: "Получаване на училищна информация включително оценки, домашни, разписание и отсъствия"
```

### Примерни заявки

След конфигуриране можете да задавате въпроси като:

- "Какви домашни има детето ми за тази седмица?"
- "Покажи ми оценките по математика за този срок"
- "Има ли неизвинени отсъствия?"
- "Какво е разписанието за утре?"

## Кеш

Данните се кешират локално за намаляване на API заявките:

```bash
# Преглед на статуса на кеша
shkolo cache status

# Изчистване на целия кеш
shkolo cache clear
```

Местоположение на кеша: `~/.shkolo/cache/`

## Конфигурация

Токенът и настройките се съхраняват в: `~/.shkolo/`

## Компилиране

```bash
# Development build (по-бърза компилация)
cargo build

# Release build (оптимизиран)
cargo build --release

# Най-малък файл (по-бавна компилация)
cargo build --profile dist
```

## Лиценз

MIT
